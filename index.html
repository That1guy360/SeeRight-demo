<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SeeRight Demo</title>
<style>
body { font-family: Arial; text-align:center; background:#111; color:white; }
input { margin:5px; padding:5px; }
canvas { margin-top:20px; }
button { padding:8px 16px; margin:10px; }
</style>
</head>
<body>

<h1>Use Your Screens Without Glasses or Contacts</h1>

<input type="number" id="sphere" placeholder="Sphere (-2.00)" step="0.25">
<button onclick="applyPrescription()">Apply</button>
<button onclick="toggle()">Before / After</button>

<br>
<canvas id="glcanvas" width="400" height="400"></canvas>

<img id="chart" src="snellen.png" crossorigin="anonymous" style="display:none;" />

<script>
const canvas = document.getElementById("glcanvas");
const gl = canvas.getContext("webgl");

const vertexShaderSource = `
attribute vec2 a_position;
varying vec2 v_uv;
void main() {
  v_uv = (a_position * 0.5) + 0.5; // map -1..1 to 0..1
  gl_Position = vec4(a_position, 0, 1);
}
`;

const fragmentShaderSource = `
precision mediump float;

uniform sampler2D u_tex;
uniform float u_sphere;
uniform bool u_apply;

varying vec2 v_uv;

void main() {
  
vec2 uv = v_uv;
 uv.y = 1.0 - uv.y; 
 uv.x = 1.0 - uv.x; 
  
  if (u_apply) {
    vec2 c = uv - 0.5;
    float r2 = dot(c, c);
    float k = u_sphere * 0.35;
    uv = uv + c * (k * r2);
  }
  uv = clamp(uv, 0.0, 1.0);
 
  gl_FragColor = texture2D(u_tex, uv);
}
`;
function compileShader(type, source) {
  const shader = gl.createShader(type);
  gl.shaderSource(shader, source);
  gl.compileShader(shader);
  return shader;
}
const vertexShader = compileShader(gl.VERTEX_SHADER, vertexShaderSource);
const fragmentShader = compileShader(gl.FRAGMENT_SHADER, fragmentShaderSource);
const program = gl.createProgram();
gl.attachShader(program, vertexShader);
gl.attachShader(program, fragmentShader);
gl.linkProgram(program);
gl.useProgram(program);
const texLocation = gl.getUniformLocation(program, "u_tex");

const texture = gl.createTexture();
gl.bindTexture(gl.TEXTURE_2D, texture);

gl.texImage2D(
  gl.TEXTURE_2D, 0, gl.RGBA, 1, 1, 0,
  gl.RGBA, gl.UNSIGNED_BYTE, new Uint8Array([0,0,0,255])
);

gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);

gl.activeTexture(gl.TEXTURE0);
gl.bindTexture(gl.TEXTURE_2D, texture);
gl.uniform1i(texLocation, 0);

function draw() {
  gl.viewport(0, 0, canvas.width, canvas.height);
  gl.drawArrays(gl.TRIANGLES, 0, 6);
}

const positionBuffer = gl.createBuffer();
gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
  -1, -1,
   1, -1,
  -1,  1,
  -1,  1,
   1, -1,
   1,  1,
]), gl.STATIC_DRAW);

const positionLocation = gl.getAttribLocation(program, "a_position");
gl.enableVertexAttribArray(positionLocation);
gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

const sphereLocation = gl.getUniformLocation(program, "u_sphere");
const applyLocation = gl.getUniformLocation(program, "u_apply");

let applyEffect = false;
gl.uniform1f(sphereLocation, 0.0);
gl.uniform1i(applyLocation, 0);

function applyPrescription() {
  const sphere = parseFloat(document.getElementById("sphere").value) || 0.0;
  gl.uniform1f(sphereLocation, sphere);
  applyEffect = true;
  gl.uniform1i(applyLocation, 1);
  gl.drawArrays(gl.TRIANGLES, 0, 6);
}

function toggle() {
  applyEffect = !applyEffect;
  gl.uniform1i(applyLocation, applyEffect ? 1 : 0);
  gl.drawArrays(gl.TRIANGLES, 0, 6);
}
const chartImg = document.getElementById("chart");
chartImg.onload = () => {
  gl.bindTexture(gl.TEXTURE_2D, texture);
  const vertexShaderSource = `
attribute vec2 a_position;
varying vec2 v_uv;
void main() {
  // Fix upside-down + backwards here (one place only)
  v_uv = vec2(
    1.0 - ((a_position.x * 0.5) + 0.5),
    1.0 - ((a_position.y * 0.5) + 0.5)
  );
  gl_Position = vec4(a_position, 0, 1);
}
`;
   gl.texImage2D(
    gl.TEXTURE_2D,
    0,
    gl.RGBA,
    gl.RGBA,
    gl.UNSIGNED_BYTE,
    chartImg
  );
  draw();
};
draw();
</script>
<div style="margin-top:16px;">
  <div>Did this improve clarity?</div>
  <button id="fbYes">Yes</button>
  <button id="fbNo">No</button>
  <div id="fbThanks" style="margin-top:10px;"></div>
</div>

<script>
  function track(eventName){
    console.log("EVENT:", eventName, new Date().toISOString());
  }
  document.getElementById("fbYes").onclick = () => {
    track("feedback_yes");
    document.getElementById("fbThanks").innerHTML =
      'Thanks. Email for updates: <a href="mailto:seeright.demo+updates@gmail.com">click here</a>';
  };
   document.getElementById("fbNo").onclick = () => {
    track("feedback_no");
    document.getElementById("fbThanks").innerText =
      "Thanks. Tell me your sphere value in the comments.";
  };
</script>

</body>
</html>


</body>
</html>
